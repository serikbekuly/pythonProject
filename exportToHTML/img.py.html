<html>
<head>
<title>img.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #629755; font-style: italic;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #808080;}
.s4 { color: #6a8759;}
.s5 { color: #6897bb;}
.s6 { color: #a5c261;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
img.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot; 
    pygments.formatters.img 
    ~~~~~~~~~~~~~~~~~~~~~~~ 
 
    Formatter for Pixmap output. 
 
    :copyright: Copyright 2006-2022 by the Pygments team, see AUTHORS. 
    :license: BSD, see LICENSE for details. 
&quot;&quot;&quot;</span>

<span class="s2">import </span><span class="s1">os</span>
<span class="s2">import </span><span class="s1">sys</span>

<span class="s2">from </span><span class="s1">pip._vendor.pygments.formatter </span><span class="s2">import </span><span class="s1">Formatter</span>
<span class="s2">from </span><span class="s1">pip._vendor.pygments.util </span><span class="s2">import </span><span class="s1">get_bool_opt</span><span class="s2">, </span><span class="s1">get_int_opt</span><span class="s2">, </span><span class="s1">get_list_opt</span><span class="s2">, </span><span class="s1">\</span>
    <span class="s1">get_choice_opt</span>

<span class="s2">import </span><span class="s1">subprocess</span>

<span class="s3"># Import this carefully</span>
<span class="s2">try</span><span class="s1">:</span>
    <span class="s2">from </span><span class="s1">PIL </span><span class="s2">import </span><span class="s1">Image</span><span class="s2">, </span><span class="s1">ImageDraw</span><span class="s2">, </span><span class="s1">ImageFont</span>
    <span class="s1">pil_available = </span><span class="s2">True</span>
<span class="s2">except </span><span class="s1">ImportError:</span>
    <span class="s1">pil_available = </span><span class="s2">False</span>

<span class="s2">try</span><span class="s1">:</span>
    <span class="s2">import </span><span class="s1">_winreg</span>
<span class="s2">except </span><span class="s1">ImportError:</span>
    <span class="s2">try</span><span class="s1">:</span>
        <span class="s2">import </span><span class="s1">winreg </span><span class="s2">as </span><span class="s1">_winreg</span>
    <span class="s2">except </span><span class="s1">ImportError:</span>
        <span class="s1">_winreg = </span><span class="s2">None</span>

<span class="s1">__all__ = [</span><span class="s4">'ImageFormatter'</span><span class="s2">, </span><span class="s4">'GifImageFormatter'</span><span class="s2">, </span><span class="s4">'JpgImageFormatter'</span><span class="s2">,</span>
           <span class="s4">'BmpImageFormatter'</span><span class="s1">]</span>


<span class="s3"># For some unknown reason every font calls it something different</span>
<span class="s1">STYLES = {</span>
    <span class="s4">'NORMAL'</span><span class="s1">:     [</span><span class="s4">''</span><span class="s2">, </span><span class="s4">'Roman'</span><span class="s2">, </span><span class="s4">'Book'</span><span class="s2">, </span><span class="s4">'Normal'</span><span class="s2">, </span><span class="s4">'Regular'</span><span class="s2">, </span><span class="s4">'Medium'</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s4">'ITALIC'</span><span class="s1">:     [</span><span class="s4">'Oblique'</span><span class="s2">, </span><span class="s4">'Italic'</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s4">'BOLD'</span><span class="s1">:       [</span><span class="s4">'Bold'</span><span class="s1">]</span><span class="s2">,</span>
    <span class="s4">'BOLDITALIC'</span><span class="s1">: [</span><span class="s4">'Bold Oblique'</span><span class="s2">, </span><span class="s4">'Bold Italic'</span><span class="s1">]</span><span class="s2">,</span>
<span class="s1">}</span>

<span class="s3"># A sane default for modern systems</span>
<span class="s1">DEFAULT_FONT_NAME_NIX = </span><span class="s4">'DejaVu Sans Mono'</span>
<span class="s1">DEFAULT_FONT_NAME_WIN = </span><span class="s4">'Courier New'</span>
<span class="s1">DEFAULT_FONT_NAME_MAC = </span><span class="s4">'Menlo'</span>


<span class="s2">class </span><span class="s1">PilNotAvailable(ImportError):</span>
    <span class="s0">&quot;&quot;&quot;When Python imaging library is not available&quot;&quot;&quot;</span>


<span class="s2">class </span><span class="s1">FontNotFound(Exception):</span>
    <span class="s0">&quot;&quot;&quot;When there are no usable fonts specified&quot;&quot;&quot;</span>


<span class="s2">class </span><span class="s1">FontManager:</span>
    <span class="s0">&quot;&quot;&quot; 
    Manages a set of fonts: normal, italic, bold, etc... 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__(self</span><span class="s2">, </span><span class="s1">font_name</span><span class="s2">, </span><span class="s1">font_size=</span><span class="s5">14</span><span class="s1">):</span>
        <span class="s1">self.font_name = font_name</span>
        <span class="s1">self.font_size = font_size</span>
        <span class="s1">self.fonts = {}</span>
        <span class="s1">self.encoding = </span><span class="s2">None</span>
        <span class="s2">if </span><span class="s1">sys.platform.startswith(</span><span class="s4">'win'</span><span class="s1">):</span>
            <span class="s2">if not </span><span class="s1">font_name:</span>
                <span class="s1">self.font_name = DEFAULT_FONT_NAME_WIN</span>
            <span class="s1">self._create_win()</span>
        <span class="s2">elif </span><span class="s1">sys.platform.startswith(</span><span class="s4">'darwin'</span><span class="s1">):</span>
            <span class="s2">if not </span><span class="s1">font_name:</span>
                <span class="s1">self.font_name = DEFAULT_FONT_NAME_MAC</span>
            <span class="s1">self._create_mac()</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s2">if not </span><span class="s1">font_name:</span>
                <span class="s1">self.font_name = DEFAULT_FONT_NAME_NIX</span>
            <span class="s1">self._create_nix()</span>

    <span class="s2">def </span><span class="s1">_get_nix_font_path(self</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">style):</span>
        <span class="s1">proc = subprocess.Popen([</span><span class="s4">'fc-list'</span><span class="s2">, </span><span class="s4">&quot;%s:style=%s&quot; </span><span class="s1">% (name</span><span class="s2">, </span><span class="s1">style)</span><span class="s2">, </span><span class="s4">'file'</span><span class="s1">]</span><span class="s2">,</span>
                                <span class="s1">stdout=subprocess.PIPE</span><span class="s2">, </span><span class="s1">stderr=</span><span class="s2">None</span><span class="s1">)</span>
        <span class="s1">stdout</span><span class="s2">, </span><span class="s1">_ = proc.communicate()</span>
        <span class="s2">if </span><span class="s1">proc.returncode == </span><span class="s5">0</span><span class="s1">:</span>
            <span class="s1">lines = stdout.splitlines()</span>
            <span class="s2">for </span><span class="s1">line </span><span class="s2">in </span><span class="s1">lines:</span>
                <span class="s2">if </span><span class="s1">line.startswith(</span><span class="s6">b'Fontconfig warning:'</span><span class="s1">):</span>
                    <span class="s2">continue</span>
                <span class="s1">path = line.decode().strip().strip(</span><span class="s4">':'</span><span class="s1">)</span>
                <span class="s2">if </span><span class="s1">path:</span>
                    <span class="s2">return </span><span class="s1">path</span>
            <span class="s2">return None</span>

    <span class="s2">def </span><span class="s1">_create_nix(self):</span>
        <span class="s2">for </span><span class="s1">name </span><span class="s2">in </span><span class="s1">STYLES[</span><span class="s4">'NORMAL'</span><span class="s1">]:</span>
            <span class="s1">path = self._get_nix_font_path(self.font_name</span><span class="s2">, </span><span class="s1">name)</span>
            <span class="s2">if </span><span class="s1">path </span><span class="s2">is not None</span><span class="s1">:</span>
                <span class="s1">self.fonts[</span><span class="s4">'NORMAL'</span><span class="s1">] = ImageFont.truetype(path</span><span class="s2">, </span><span class="s1">self.font_size)</span>
                <span class="s2">break</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s2">raise </span><span class="s1">FontNotFound(</span><span class="s4">'No usable fonts named: &quot;%s&quot;' </span><span class="s1">%</span>
                               <span class="s1">self.font_name)</span>
        <span class="s2">for </span><span class="s1">style </span><span class="s2">in </span><span class="s1">(</span><span class="s4">'ITALIC'</span><span class="s2">, </span><span class="s4">'BOLD'</span><span class="s2">, </span><span class="s4">'BOLDITALIC'</span><span class="s1">):</span>
            <span class="s2">for </span><span class="s1">stylename </span><span class="s2">in </span><span class="s1">STYLES[style]:</span>
                <span class="s1">path = self._get_nix_font_path(self.font_name</span><span class="s2">, </span><span class="s1">stylename)</span>
                <span class="s2">if </span><span class="s1">path </span><span class="s2">is not None</span><span class="s1">:</span>
                    <span class="s1">self.fonts[style] = ImageFont.truetype(path</span><span class="s2">, </span><span class="s1">self.font_size)</span>
                    <span class="s2">break</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s2">if </span><span class="s1">style == </span><span class="s4">'BOLDITALIC'</span><span class="s1">:</span>
                    <span class="s1">self.fonts[style] = self.fonts[</span><span class="s4">'BOLD'</span><span class="s1">]</span>
                <span class="s2">else</span><span class="s1">:</span>
                    <span class="s1">self.fonts[style] = self.fonts[</span><span class="s4">'NORMAL'</span><span class="s1">]</span>

    <span class="s2">def </span><span class="s1">_get_mac_font_path(self</span><span class="s2">, </span><span class="s1">font_map</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">style):</span>
        <span class="s2">return </span><span class="s1">font_map.get((name + </span><span class="s4">' ' </span><span class="s1">+ style).strip().lower())</span>

    <span class="s2">def </span><span class="s1">_create_mac(self):</span>
        <span class="s1">font_map = {}</span>
        <span class="s2">for </span><span class="s1">font_dir </span><span class="s2">in </span><span class="s1">(os.path.join(os.getenv(</span><span class="s4">&quot;HOME&quot;</span><span class="s1">)</span><span class="s2">, </span><span class="s4">'Library/Fonts/'</span><span class="s1">)</span><span class="s2">,</span>
                         <span class="s4">'/Library/Fonts/'</span><span class="s2">, </span><span class="s4">'/System/Library/Fonts/'</span><span class="s1">):</span>
            <span class="s1">font_map.update(</span>
                <span class="s1">(os.path.splitext(f)[</span><span class="s5">0</span><span class="s1">].lower()</span><span class="s2">, </span><span class="s1">os.path.join(font_dir</span><span class="s2">, </span><span class="s1">f))</span>
                <span class="s2">for </span><span class="s1">f </span><span class="s2">in </span><span class="s1">os.listdir(font_dir)</span>
                <span class="s2">if </span><span class="s1">f.lower().endswith((</span><span class="s4">'ttf'</span><span class="s2">, </span><span class="s4">'ttc'</span><span class="s1">)))</span>

        <span class="s2">for </span><span class="s1">name </span><span class="s2">in </span><span class="s1">STYLES[</span><span class="s4">'NORMAL'</span><span class="s1">]:</span>
            <span class="s1">path = self._get_mac_font_path(font_map</span><span class="s2">, </span><span class="s1">self.font_name</span><span class="s2">, </span><span class="s1">name)</span>
            <span class="s2">if </span><span class="s1">path </span><span class="s2">is not None</span><span class="s1">:</span>
                <span class="s1">self.fonts[</span><span class="s4">'NORMAL'</span><span class="s1">] = ImageFont.truetype(path</span><span class="s2">, </span><span class="s1">self.font_size)</span>
                <span class="s2">break</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s2">raise </span><span class="s1">FontNotFound(</span><span class="s4">'No usable fonts named: &quot;%s&quot;' </span><span class="s1">%</span>
                               <span class="s1">self.font_name)</span>
        <span class="s2">for </span><span class="s1">style </span><span class="s2">in </span><span class="s1">(</span><span class="s4">'ITALIC'</span><span class="s2">, </span><span class="s4">'BOLD'</span><span class="s2">, </span><span class="s4">'BOLDITALIC'</span><span class="s1">):</span>
            <span class="s2">for </span><span class="s1">stylename </span><span class="s2">in </span><span class="s1">STYLES[style]:</span>
                <span class="s1">path = self._get_mac_font_path(font_map</span><span class="s2">, </span><span class="s1">self.font_name</span><span class="s2">, </span><span class="s1">stylename)</span>
                <span class="s2">if </span><span class="s1">path </span><span class="s2">is not None</span><span class="s1">:</span>
                    <span class="s1">self.fonts[style] = ImageFont.truetype(path</span><span class="s2">, </span><span class="s1">self.font_size)</span>
                    <span class="s2">break</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s2">if </span><span class="s1">style == </span><span class="s4">'BOLDITALIC'</span><span class="s1">:</span>
                    <span class="s1">self.fonts[style] = self.fonts[</span><span class="s4">'BOLD'</span><span class="s1">]</span>
                <span class="s2">else</span><span class="s1">:</span>
                    <span class="s1">self.fonts[style] = self.fonts[</span><span class="s4">'NORMAL'</span><span class="s1">]</span>

    <span class="s2">def </span><span class="s1">_lookup_win(self</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">basename</span><span class="s2">, </span><span class="s1">styles</span><span class="s2">, </span><span class="s1">fail=</span><span class="s2">False</span><span class="s1">):</span>
        <span class="s2">for </span><span class="s1">suffix </span><span class="s2">in </span><span class="s1">(</span><span class="s4">''</span><span class="s2">, </span><span class="s4">' (TrueType)'</span><span class="s1">):</span>
            <span class="s2">for </span><span class="s1">style </span><span class="s2">in </span><span class="s1">styles:</span>
                <span class="s2">try</span><span class="s1">:</span>
                    <span class="s1">valname = </span><span class="s4">'%s%s%s' </span><span class="s1">% (basename</span><span class="s2">, </span><span class="s1">style </span><span class="s2">and </span><span class="s4">' '</span><span class="s1">+style</span><span class="s2">, </span><span class="s1">suffix)</span>
                    <span class="s1">val</span><span class="s2">, </span><span class="s1">_ = _winreg.QueryValueEx(key</span><span class="s2">, </span><span class="s1">valname)</span>
                    <span class="s2">return </span><span class="s1">val</span>
                <span class="s2">except </span><span class="s1">OSError:</span>
                    <span class="s2">continue</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s2">if </span><span class="s1">fail:</span>
                <span class="s2">raise </span><span class="s1">FontNotFound(</span><span class="s4">'Font %s (%s) not found in registry' </span><span class="s1">%</span>
                                   <span class="s1">(basename</span><span class="s2">, </span><span class="s1">styles[</span><span class="s5">0</span><span class="s1">]))</span>
            <span class="s2">return None</span>

    <span class="s2">def </span><span class="s1">_create_win(self):</span>
        <span class="s1">lookuperror = </span><span class="s2">None</span>
        <span class="s1">keynames = [ (_winreg.HKEY_CURRENT_USER</span><span class="s2">, </span><span class="s4">r'Software\Microsoft\Windows NT\CurrentVersion\Fonts'</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s1">(_winreg.HKEY_CURRENT_USER</span><span class="s2">, </span><span class="s4">r'Software\Microsoft\Windows\CurrentVersion\Fonts'</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s1">(_winreg.HKEY_LOCAL_MACHINE</span><span class="s2">, </span><span class="s4">r'Software\Microsoft\Windows NT\CurrentVersion\Fonts'</span><span class="s1">)</span><span class="s2">,</span>
                     <span class="s1">(_winreg.HKEY_LOCAL_MACHINE</span><span class="s2">, </span><span class="s4">r'Software\Microsoft\Windows\CurrentVersion\Fonts'</span><span class="s1">) ]</span>
        <span class="s2">for </span><span class="s1">keyname </span><span class="s2">in </span><span class="s1">keynames:</span>
            <span class="s2">try</span><span class="s1">:</span>
                <span class="s1">key = _winreg.OpenKey(*keyname)</span>
                <span class="s2">try</span><span class="s1">:</span>
                    <span class="s1">path = self._lookup_win(key</span><span class="s2">, </span><span class="s1">self.font_name</span><span class="s2">, </span><span class="s1">STYLES[</span><span class="s4">'NORMAL'</span><span class="s1">]</span><span class="s2">, True</span><span class="s1">)</span>
                    <span class="s1">self.fonts[</span><span class="s4">'NORMAL'</span><span class="s1">] = ImageFont.truetype(path</span><span class="s2">, </span><span class="s1">self.font_size)</span>
                    <span class="s2">for </span><span class="s1">style </span><span class="s2">in </span><span class="s1">(</span><span class="s4">'ITALIC'</span><span class="s2">, </span><span class="s4">'BOLD'</span><span class="s2">, </span><span class="s4">'BOLDITALIC'</span><span class="s1">):</span>
                        <span class="s1">path = self._lookup_win(key</span><span class="s2">, </span><span class="s1">self.font_name</span><span class="s2">, </span><span class="s1">STYLES[style])</span>
                        <span class="s2">if </span><span class="s1">path:</span>
                            <span class="s1">self.fonts[style] = ImageFont.truetype(path</span><span class="s2">, </span><span class="s1">self.font_size)</span>
                        <span class="s2">else</span><span class="s1">:</span>
                            <span class="s2">if </span><span class="s1">style == </span><span class="s4">'BOLDITALIC'</span><span class="s1">:</span>
                                <span class="s1">self.fonts[style] = self.fonts[</span><span class="s4">'BOLD'</span><span class="s1">]</span>
                            <span class="s2">else</span><span class="s1">:</span>
                                <span class="s1">self.fonts[style] = self.fonts[</span><span class="s4">'NORMAL'</span><span class="s1">]</span>
                    <span class="s2">return</span>
                <span class="s2">except </span><span class="s1">FontNotFound </span><span class="s2">as </span><span class="s1">err:</span>
                    <span class="s1">lookuperror = err</span>
                <span class="s2">finally</span><span class="s1">:</span>
                    <span class="s1">_winreg.CloseKey(key)</span>
            <span class="s2">except </span><span class="s1">OSError:</span>
                <span class="s2">pass</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s3"># If we get here, we checked all registry keys and had no luck</span>
            <span class="s3"># We can be in one of two situations now:</span>
            <span class="s3"># * All key lookups failed. In this case lookuperror is None and we</span>
            <span class="s3">#   will raise a generic error</span>
            <span class="s3"># * At least one lookup failed with a FontNotFound error. In this</span>
            <span class="s3">#   case, we will raise that as a more specific error</span>
            <span class="s2">if </span><span class="s1">lookuperror:</span>
                <span class="s2">raise </span><span class="s1">lookuperror</span>
            <span class="s2">raise </span><span class="s1">FontNotFound(</span><span class="s4">'Can</span><span class="s2">\'</span><span class="s4">t open Windows font registry key'</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">get_char_size(self):</span>
        <span class="s0">&quot;&quot;&quot; 
        Get the character size. 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self.get_text_size(</span><span class="s4">'M'</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">get_text_size(self</span><span class="s2">, </span><span class="s1">text):</span>
        <span class="s0">&quot;&quot;&quot; 
        Get the text size (width, height). 
        &quot;&quot;&quot;</span>
        <span class="s1">font = self.fonts[</span><span class="s4">'NORMAL'</span><span class="s1">]</span>
        <span class="s2">if </span><span class="s1">hasattr(font</span><span class="s2">, </span><span class="s4">'getbbox'</span><span class="s1">):  </span><span class="s3"># Pillow &gt;= 9.2.0</span>
            <span class="s2">return </span><span class="s1">font.getbbox(text)[</span><span class="s5">2</span><span class="s1">:</span><span class="s5">4</span><span class="s1">]</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s2">return </span><span class="s1">font.getsize(text)</span>

    <span class="s2">def </span><span class="s1">get_font(self</span><span class="s2">, </span><span class="s1">bold</span><span class="s2">, </span><span class="s1">oblique):</span>
        <span class="s0">&quot;&quot;&quot; 
        Get the font based on bold and italic flags. 
        &quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">bold </span><span class="s2">and </span><span class="s1">oblique:</span>
            <span class="s2">return </span><span class="s1">self.fonts[</span><span class="s4">'BOLDITALIC'</span><span class="s1">]</span>
        <span class="s2">elif </span><span class="s1">bold:</span>
            <span class="s2">return </span><span class="s1">self.fonts[</span><span class="s4">'BOLD'</span><span class="s1">]</span>
        <span class="s2">elif </span><span class="s1">oblique:</span>
            <span class="s2">return </span><span class="s1">self.fonts[</span><span class="s4">'ITALIC'</span><span class="s1">]</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s2">return </span><span class="s1">self.fonts[</span><span class="s4">'NORMAL'</span><span class="s1">]</span>


<span class="s2">class </span><span class="s1">ImageFormatter(Formatter):</span>
    <span class="s0">&quot;&quot;&quot; 
    Create a PNG image from source code. This uses the Python Imaging Library to 
    generate a pixmap from the source code. 
 
    .. versionadded:: 0.10 
 
    Additional options accepted: 
 
    `image_format` 
        An image format to output to that is recognised by PIL, these include: 
 
        * &quot;PNG&quot; (default) 
        * &quot;JPEG&quot; 
        * &quot;BMP&quot; 
        * &quot;GIF&quot; 
 
    `line_pad` 
        The extra spacing (in pixels) between each line of text. 
 
        Default: 2 
 
    `font_name` 
        The font name to be used as the base font from which others, such as 
        bold and italic fonts will be generated.  This really should be a 
        monospace font to look sane. 
 
        Default: &quot;Courier New&quot; on Windows, &quot;Menlo&quot; on Mac OS, and 
                 &quot;DejaVu Sans Mono&quot; on \\*nix 
 
    `font_size` 
        The font size in points to be used. 
 
        Default: 14 
 
    `image_pad` 
        The padding, in pixels to be used at each edge of the resulting image. 
 
        Default: 10 
 
    `line_numbers` 
        Whether line numbers should be shown: True/False 
 
        Default: True 
 
    `line_number_start` 
        The line number of the first line. 
 
        Default: 1 
 
    `line_number_step` 
        The step used when printing line numbers. 
 
        Default: 1 
 
    `line_number_bg` 
        The background colour (in &quot;#123456&quot; format) of the line number bar, or 
        None to use the style background color. 
 
        Default: &quot;#eed&quot; 
 
    `line_number_fg` 
        The text color of the line numbers (in &quot;#123456&quot;-like format). 
 
        Default: &quot;#886&quot; 
 
    `line_number_chars` 
        The number of columns of line numbers allowable in the line number 
        margin. 
 
        Default: 2 
 
    `line_number_bold` 
        Whether line numbers will be bold: True/False 
 
        Default: False 
 
    `line_number_italic` 
        Whether line numbers will be italicized: True/False 
 
        Default: False 
 
    `line_number_separator` 
        Whether a line will be drawn between the line number area and the 
        source code area: True/False 
 
        Default: True 
 
    `line_number_pad` 
        The horizontal padding (in pixels) between the line number margin, and 
        the source code area. 
 
        Default: 6 
 
    `hl_lines` 
        Specify a list of lines to be highlighted. 
 
        .. versionadded:: 1.2 
 
        Default: empty list 
 
    `hl_color` 
        Specify the color for highlighting lines. 
 
        .. versionadded:: 1.2 
 
        Default: highlight color of the selected style 
    &quot;&quot;&quot;</span>

    <span class="s3"># Required by the pygments mapper</span>
    <span class="s1">name = </span><span class="s4">'img'</span>
    <span class="s1">aliases = [</span><span class="s4">'img'</span><span class="s2">, </span><span class="s4">'IMG'</span><span class="s2">, </span><span class="s4">'png'</span><span class="s1">]</span>
    <span class="s1">filenames = [</span><span class="s4">'*.png'</span><span class="s1">]</span>

    <span class="s1">unicodeoutput = </span><span class="s2">False</span>

    <span class="s1">default_image_format = </span><span class="s4">'png'</span>

    <span class="s2">def </span><span class="s1">__init__(self</span><span class="s2">, </span><span class="s1">**options):</span>
        <span class="s0">&quot;&quot;&quot; 
        See the class docstring for explanation of options. 
        &quot;&quot;&quot;</span>
        <span class="s2">if not </span><span class="s1">pil_available:</span>
            <span class="s2">raise </span><span class="s1">PilNotAvailable(</span>
                <span class="s4">'Python Imaging Library is required for this formatter'</span><span class="s1">)</span>
        <span class="s1">Formatter.__init__(self</span><span class="s2">, </span><span class="s1">**options)</span>
        <span class="s1">self.encoding = </span><span class="s4">'latin1'  </span><span class="s3"># let pygments.format() do the right thing</span>
        <span class="s3"># Read the style</span>
        <span class="s1">self.styles = dict(self.style)</span>
        <span class="s2">if </span><span class="s1">self.style.background_color </span><span class="s2">is None</span><span class="s1">:</span>
            <span class="s1">self.background_color = </span><span class="s4">'#fff'</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">self.background_color = self.style.background_color</span>
        <span class="s3"># Image options</span>
        <span class="s1">self.image_format = get_choice_opt(</span>
            <span class="s1">options</span><span class="s2">, </span><span class="s4">'image_format'</span><span class="s2">, </span><span class="s1">[</span><span class="s4">'png'</span><span class="s2">, </span><span class="s4">'jpeg'</span><span class="s2">, </span><span class="s4">'gif'</span><span class="s2">, </span><span class="s4">'bmp'</span><span class="s1">]</span><span class="s2">,</span>
            <span class="s1">self.default_image_format</span><span class="s2">, </span><span class="s1">normcase=</span><span class="s2">True</span><span class="s1">)</span>
        <span class="s1">self.image_pad = get_int_opt(options</span><span class="s2">, </span><span class="s4">'image_pad'</span><span class="s2">, </span><span class="s5">10</span><span class="s1">)</span>
        <span class="s1">self.line_pad = get_int_opt(options</span><span class="s2">, </span><span class="s4">'line_pad'</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span>
        <span class="s3"># The fonts</span>
        <span class="s1">fontsize = get_int_opt(options</span><span class="s2">, </span><span class="s4">'font_size'</span><span class="s2">, </span><span class="s5">14</span><span class="s1">)</span>
        <span class="s1">self.fonts = FontManager(options.get(</span><span class="s4">'font_name'</span><span class="s2">, </span><span class="s4">''</span><span class="s1">)</span><span class="s2">, </span><span class="s1">fontsize)</span>
        <span class="s1">self.fontw</span><span class="s2">, </span><span class="s1">self.fonth = self.fonts.get_char_size()</span>
        <span class="s3"># Line number options</span>
        <span class="s1">self.line_number_fg = options.get(</span><span class="s4">'line_number_fg'</span><span class="s2">, </span><span class="s4">'#886'</span><span class="s1">)</span>
        <span class="s1">self.line_number_bg = options.get(</span><span class="s4">'line_number_bg'</span><span class="s2">, </span><span class="s4">'#eed'</span><span class="s1">)</span>
        <span class="s1">self.line_number_chars = get_int_opt(options</span><span class="s2">,</span>
                                             <span class="s4">'line_number_chars'</span><span class="s2">, </span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">self.line_number_bold = get_bool_opt(options</span><span class="s2">,</span>
                                             <span class="s4">'line_number_bold'</span><span class="s2">, False</span><span class="s1">)</span>
        <span class="s1">self.line_number_italic = get_bool_opt(options</span><span class="s2">,</span>
                                               <span class="s4">'line_number_italic'</span><span class="s2">, False</span><span class="s1">)</span>
        <span class="s1">self.line_number_pad = get_int_opt(options</span><span class="s2">, </span><span class="s4">'line_number_pad'</span><span class="s2">, </span><span class="s5">6</span><span class="s1">)</span>
        <span class="s1">self.line_numbers = get_bool_opt(options</span><span class="s2">, </span><span class="s4">'line_numbers'</span><span class="s2">, True</span><span class="s1">)</span>
        <span class="s1">self.line_number_separator = get_bool_opt(options</span><span class="s2">,</span>
                                                  <span class="s4">'line_number_separator'</span><span class="s2">, True</span><span class="s1">)</span>
        <span class="s1">self.line_number_step = get_int_opt(options</span><span class="s2">, </span><span class="s4">'line_number_step'</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">self.line_number_start = get_int_opt(options</span><span class="s2">, </span><span class="s4">'line_number_start'</span><span class="s2">, </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s2">if </span><span class="s1">self.line_numbers:</span>
            <span class="s1">self.line_number_width = (self.fontw * self.line_number_chars +</span>
                                      <span class="s1">self.line_number_pad * </span><span class="s5">2</span><span class="s1">)</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">self.line_number_width = </span><span class="s5">0</span>
        <span class="s1">self.hl_lines = []</span>
        <span class="s1">hl_lines_str = get_list_opt(options</span><span class="s2">, </span><span class="s4">'hl_lines'</span><span class="s2">, </span><span class="s1">[])</span>
        <span class="s2">for </span><span class="s1">line </span><span class="s2">in </span><span class="s1">hl_lines_str:</span>
            <span class="s2">try</span><span class="s1">:</span>
                <span class="s1">self.hl_lines.append(int(line))</span>
            <span class="s2">except </span><span class="s1">ValueError:</span>
                <span class="s2">pass</span>
        <span class="s1">self.hl_color = options.get(</span><span class="s4">'hl_color'</span><span class="s2">,</span>
                                    <span class="s1">self.style.highlight_color) </span><span class="s2">or </span><span class="s4">'#f90'</span>
        <span class="s1">self.drawables = []</span>

    <span class="s2">def </span><span class="s1">get_style_defs(self</span><span class="s2">, </span><span class="s1">arg=</span><span class="s4">''</span><span class="s1">):</span>
        <span class="s2">raise </span><span class="s1">NotImplementedError(</span><span class="s4">'The -S option is meaningless for the image '</span>
                                  <span class="s4">'formatter. Use -O style=&lt;stylename&gt; instead.'</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">_get_line_height(self):</span>
        <span class="s0">&quot;&quot;&quot; 
        Get the height of a line. 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self.fonth + self.line_pad</span>

    <span class="s2">def </span><span class="s1">_get_line_y(self</span><span class="s2">, </span><span class="s1">lineno):</span>
        <span class="s0">&quot;&quot;&quot; 
        Get the Y coordinate of a line number. 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">lineno * self._get_line_height() + self.image_pad</span>

    <span class="s2">def </span><span class="s1">_get_char_width(self):</span>
        <span class="s0">&quot;&quot;&quot; 
        Get the width of a character. 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self.fontw</span>

    <span class="s2">def </span><span class="s1">_get_char_x(self</span><span class="s2">, </span><span class="s1">linelength):</span>
        <span class="s0">&quot;&quot;&quot; 
        Get the X coordinate of a character position. 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">linelength + self.image_pad + self.line_number_width</span>

    <span class="s2">def </span><span class="s1">_get_text_pos(self</span><span class="s2">, </span><span class="s1">linelength</span><span class="s2">, </span><span class="s1">lineno):</span>
        <span class="s0">&quot;&quot;&quot; 
        Get the actual position for a character and line position. 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self._get_char_x(linelength)</span><span class="s2">, </span><span class="s1">self._get_line_y(lineno)</span>

    <span class="s2">def </span><span class="s1">_get_linenumber_pos(self</span><span class="s2">, </span><span class="s1">lineno):</span>
        <span class="s0">&quot;&quot;&quot; 
        Get the actual position for the start of a line number. 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">(self.image_pad</span><span class="s2">, </span><span class="s1">self._get_line_y(lineno))</span>

    <span class="s2">def </span><span class="s1">_get_text_color(self</span><span class="s2">, </span><span class="s1">style):</span>
        <span class="s0">&quot;&quot;&quot; 
        Get the correct color for the token from the style. 
        &quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">style[</span><span class="s4">'color'</span><span class="s1">] </span><span class="s2">is not None</span><span class="s1">:</span>
            <span class="s1">fill = </span><span class="s4">'#' </span><span class="s1">+ style[</span><span class="s4">'color'</span><span class="s1">]</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">fill = </span><span class="s4">'#000'</span>
        <span class="s2">return </span><span class="s1">fill</span>

    <span class="s2">def </span><span class="s1">_get_text_bg_color(self</span><span class="s2">, </span><span class="s1">style):</span>
        <span class="s0">&quot;&quot;&quot; 
        Get the correct background color for the token from the style. 
        &quot;&quot;&quot;</span>
        <span class="s2">if </span><span class="s1">style[</span><span class="s4">'bgcolor'</span><span class="s1">] </span><span class="s2">is not None</span><span class="s1">:</span>
            <span class="s1">bg_color = </span><span class="s4">'#' </span><span class="s1">+ style[</span><span class="s4">'bgcolor'</span><span class="s1">]</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">bg_color = </span><span class="s2">None</span>
        <span class="s2">return </span><span class="s1">bg_color</span>

    <span class="s2">def </span><span class="s1">_get_style_font(self</span><span class="s2">, </span><span class="s1">style):</span>
        <span class="s0">&quot;&quot;&quot; 
        Get the correct font for the style. 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">self.fonts.get_font(style[</span><span class="s4">'bold'</span><span class="s1">]</span><span class="s2">, </span><span class="s1">style[</span><span class="s4">'italic'</span><span class="s1">])</span>

    <span class="s2">def </span><span class="s1">_get_image_size(self</span><span class="s2">, </span><span class="s1">maxlinelength</span><span class="s2">, </span><span class="s1">maxlineno):</span>
        <span class="s0">&quot;&quot;&quot; 
        Get the required image size. 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">(self._get_char_x(maxlinelength) + self.image_pad</span><span class="s2">,</span>
                <span class="s1">self._get_line_y(maxlineno + </span><span class="s5">0</span><span class="s1">) + self.image_pad)</span>

    <span class="s2">def </span><span class="s1">_draw_linenumber(self</span><span class="s2">, </span><span class="s1">posno</span><span class="s2">, </span><span class="s1">lineno):</span>
        <span class="s0">&quot;&quot;&quot; 
        Remember a line number drawable to paint later. 
        &quot;&quot;&quot;</span>
        <span class="s1">self._draw_text(</span>
            <span class="s1">self._get_linenumber_pos(posno)</span><span class="s2">,</span>
            <span class="s1">str(lineno).rjust(self.line_number_chars)</span><span class="s2">,</span>
            <span class="s1">font=self.fonts.get_font(self.line_number_bold</span><span class="s2">,</span>
                                     <span class="s1">self.line_number_italic)</span><span class="s2">,</span>
            <span class="s1">text_fg=self.line_number_fg</span><span class="s2">,</span>
            <span class="s1">text_bg=</span><span class="s2">None,</span>
        <span class="s1">)</span>

    <span class="s2">def </span><span class="s1">_draw_text(self</span><span class="s2">, </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">font</span><span class="s2">, </span><span class="s1">text_fg</span><span class="s2">, </span><span class="s1">text_bg):</span>
        <span class="s0">&quot;&quot;&quot; 
        Remember a single drawable tuple to paint later. 
        &quot;&quot;&quot;</span>
        <span class="s1">self.drawables.append((pos</span><span class="s2">, </span><span class="s1">text</span><span class="s2">, </span><span class="s1">font</span><span class="s2">, </span><span class="s1">text_fg</span><span class="s2">, </span><span class="s1">text_bg))</span>

    <span class="s2">def </span><span class="s1">_create_drawables(self</span><span class="s2">, </span><span class="s1">tokensource):</span>
        <span class="s0">&quot;&quot;&quot; 
        Create drawables for the token content. 
        &quot;&quot;&quot;</span>
        <span class="s1">lineno = charno = maxcharno = </span><span class="s5">0</span>
        <span class="s1">maxlinelength = linelength = </span><span class="s5">0</span>
        <span class="s2">for </span><span class="s1">ttype</span><span class="s2">, </span><span class="s1">value </span><span class="s2">in </span><span class="s1">tokensource:</span>
            <span class="s2">while </span><span class="s1">ttype </span><span class="s2">not in </span><span class="s1">self.styles:</span>
                <span class="s1">ttype = ttype.parent</span>
            <span class="s1">style = self.styles[ttype]</span>
            <span class="s3"># TODO: make sure tab expansion happens earlier in the chain.  It</span>
            <span class="s3"># really ought to be done on the input, as to do it right here is</span>
            <span class="s3"># quite complex.</span>
            <span class="s1">value = value.expandtabs(</span><span class="s5">4</span><span class="s1">)</span>
            <span class="s1">lines = value.splitlines(</span><span class="s2">True</span><span class="s1">)</span>
            <span class="s3"># print lines</span>
            <span class="s2">for </span><span class="s1">i</span><span class="s2">, </span><span class="s1">line </span><span class="s2">in </span><span class="s1">enumerate(lines):</span>
                <span class="s1">temp = line.rstrip(</span><span class="s4">'</span><span class="s2">\n</span><span class="s4">'</span><span class="s1">)</span>
                <span class="s2">if </span><span class="s1">temp:</span>
                    <span class="s1">self._draw_text(</span>
                        <span class="s1">self._get_text_pos(linelength</span><span class="s2">, </span><span class="s1">lineno)</span><span class="s2">,</span>
                        <span class="s1">temp</span><span class="s2">,</span>
                        <span class="s1">font = self._get_style_font(style)</span><span class="s2">,</span>
                        <span class="s1">text_fg = self._get_text_color(style)</span><span class="s2">,</span>
                        <span class="s1">text_bg = self._get_text_bg_color(style)</span><span class="s2">,</span>
                    <span class="s1">)</span>
                    <span class="s1">temp_width</span><span class="s2">, </span><span class="s1">_ = self.fonts.get_text_size(temp)</span>
                    <span class="s1">linelength += temp_width</span>
                    <span class="s1">maxlinelength = max(maxlinelength</span><span class="s2">, </span><span class="s1">linelength)</span>
                    <span class="s1">charno += len(temp)</span>
                    <span class="s1">maxcharno = max(maxcharno</span><span class="s2">, </span><span class="s1">charno)</span>
                <span class="s2">if </span><span class="s1">line.endswith(</span><span class="s4">'</span><span class="s2">\n</span><span class="s4">'</span><span class="s1">):</span>
                    <span class="s3"># add a line for each extra line in the value</span>
                    <span class="s1">linelength = </span><span class="s5">0</span>
                    <span class="s1">charno = </span><span class="s5">0</span>
                    <span class="s1">lineno += </span><span class="s5">1</span>
        <span class="s1">self.maxlinelength = maxlinelength</span>
        <span class="s1">self.maxcharno = maxcharno</span>
        <span class="s1">self.maxlineno = lineno</span>

    <span class="s2">def </span><span class="s1">_draw_line_numbers(self):</span>
        <span class="s0">&quot;&quot;&quot; 
        Create drawables for the line numbers. 
        &quot;&quot;&quot;</span>
        <span class="s2">if not </span><span class="s1">self.line_numbers:</span>
            <span class="s2">return</span>
        <span class="s2">for </span><span class="s1">p </span><span class="s2">in </span><span class="s1">range(self.maxlineno):</span>
            <span class="s1">n = p + self.line_number_start</span>
            <span class="s2">if </span><span class="s1">(n % self.line_number_step) == </span><span class="s5">0</span><span class="s1">:</span>
                <span class="s1">self._draw_linenumber(p</span><span class="s2">, </span><span class="s1">n)</span>

    <span class="s2">def </span><span class="s1">_paint_line_number_bg(self</span><span class="s2">, </span><span class="s1">im):</span>
        <span class="s0">&quot;&quot;&quot; 
        Paint the line number background on the image. 
        &quot;&quot;&quot;</span>
        <span class="s2">if not </span><span class="s1">self.line_numbers:</span>
            <span class="s2">return</span>
        <span class="s2">if </span><span class="s1">self.line_number_fg </span><span class="s2">is None</span><span class="s1">:</span>
            <span class="s2">return</span>
        <span class="s1">draw = ImageDraw.Draw(im)</span>
        <span class="s1">recth = im.size[-</span><span class="s5">1</span><span class="s1">]</span>
        <span class="s1">rectw = self.image_pad + self.line_number_width - self.line_number_pad</span>
        <span class="s1">draw.rectangle([(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(rectw</span><span class="s2">, </span><span class="s1">recth)]</span><span class="s2">,</span>
                       <span class="s1">fill=self.line_number_bg)</span>
        <span class="s2">if </span><span class="s1">self.line_number_separator:</span>
            <span class="s1">draw.line([(rectw</span><span class="s2">, </span><span class="s5">0</span><span class="s1">)</span><span class="s2">, </span><span class="s1">(rectw</span><span class="s2">, </span><span class="s1">recth)]</span><span class="s2">, </span><span class="s1">fill=self.line_number_fg)</span>
        <span class="s2">del </span><span class="s1">draw</span>

    <span class="s2">def </span><span class="s1">format(self</span><span class="s2">, </span><span class="s1">tokensource</span><span class="s2">, </span><span class="s1">outfile):</span>
        <span class="s0">&quot;&quot;&quot; 
        Format ``tokensource``, an iterable of ``(tokentype, tokenstring)`` 
        tuples and write it into ``outfile``. 
 
        This implementation calculates where it should draw each token on the 
        pixmap, then calculates the required pixmap size and draws the items. 
        &quot;&quot;&quot;</span>
        <span class="s1">self._create_drawables(tokensource)</span>
        <span class="s1">self._draw_line_numbers()</span>
        <span class="s1">im = Image.new(</span>
            <span class="s4">'RGB'</span><span class="s2">,</span>
            <span class="s1">self._get_image_size(self.maxlinelength</span><span class="s2">, </span><span class="s1">self.maxlineno)</span><span class="s2">,</span>
            <span class="s1">self.background_color</span>
        <span class="s1">)</span>
        <span class="s1">self._paint_line_number_bg(im)</span>
        <span class="s1">draw = ImageDraw.Draw(im)</span>
        <span class="s3"># Highlight</span>
        <span class="s2">if </span><span class="s1">self.hl_lines:</span>
            <span class="s1">x = self.image_pad + self.line_number_width - self.line_number_pad + </span><span class="s5">1</span>
            <span class="s1">recth = self._get_line_height()</span>
            <span class="s1">rectw = im.size[</span><span class="s5">0</span><span class="s1">] - x</span>
            <span class="s2">for </span><span class="s1">linenumber </span><span class="s2">in </span><span class="s1">self.hl_lines:</span>
                <span class="s1">y = self._get_line_y(linenumber - </span><span class="s5">1</span><span class="s1">)</span>
                <span class="s1">draw.rectangle([(x</span><span class="s2">, </span><span class="s1">y)</span><span class="s2">, </span><span class="s1">(x + rectw</span><span class="s2">, </span><span class="s1">y + recth)]</span><span class="s2">,</span>
                               <span class="s1">fill=self.hl_color)</span>
        <span class="s2">for </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">font</span><span class="s2">, </span><span class="s1">text_fg</span><span class="s2">, </span><span class="s1">text_bg </span><span class="s2">in </span><span class="s1">self.drawables:</span>
            <span class="s2">if </span><span class="s1">text_bg:</span>
                <span class="s1">text_size = draw.textsize(text=value</span><span class="s2">, </span><span class="s1">font=font)</span>
                <span class="s1">draw.rectangle([pos[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">pos[</span><span class="s5">1</span><span class="s1">]</span><span class="s2">, </span><span class="s1">pos[</span><span class="s5">0</span><span class="s1">] + text_size[</span><span class="s5">0</span><span class="s1">]</span><span class="s2">, </span><span class="s1">pos[</span><span class="s5">1</span><span class="s1">] + text_size[</span><span class="s5">1</span><span class="s1">]]</span><span class="s2">, </span><span class="s1">fill=text_bg)</span>
            <span class="s1">draw.text(pos</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">font=font</span><span class="s2">, </span><span class="s1">fill=text_fg)</span>
        <span class="s1">im.save(outfile</span><span class="s2">, </span><span class="s1">self.image_format.upper())</span>


<span class="s3"># Add one formatter per format, so that the &quot;-f gif&quot; option gives the correct result</span>
<span class="s3"># when used in pygmentize.</span>

<span class="s2">class </span><span class="s1">GifImageFormatter(ImageFormatter):</span>
    <span class="s0">&quot;&quot;&quot; 
    Create a GIF image from source code. This uses the Python Imaging Library to 
    generate a pixmap from the source code. 
 
    .. versionadded:: 1.0 
    &quot;&quot;&quot;</span>

    <span class="s1">name = </span><span class="s4">'img_gif'</span>
    <span class="s1">aliases = [</span><span class="s4">'gif'</span><span class="s1">]</span>
    <span class="s1">filenames = [</span><span class="s4">'*.gif'</span><span class="s1">]</span>
    <span class="s1">default_image_format = </span><span class="s4">'gif'</span>


<span class="s2">class </span><span class="s1">JpgImageFormatter(ImageFormatter):</span>
    <span class="s0">&quot;&quot;&quot; 
    Create a JPEG image from source code. This uses the Python Imaging Library to 
    generate a pixmap from the source code. 
 
    .. versionadded:: 1.0 
    &quot;&quot;&quot;</span>

    <span class="s1">name = </span><span class="s4">'img_jpg'</span>
    <span class="s1">aliases = [</span><span class="s4">'jpg'</span><span class="s2">, </span><span class="s4">'jpeg'</span><span class="s1">]</span>
    <span class="s1">filenames = [</span><span class="s4">'*.jpg'</span><span class="s1">]</span>
    <span class="s1">default_image_format = </span><span class="s4">'jpeg'</span>


<span class="s2">class </span><span class="s1">BmpImageFormatter(ImageFormatter):</span>
    <span class="s0">&quot;&quot;&quot; 
    Create a bitmap image from source code. This uses the Python Imaging Library to 
    generate a pixmap from the source code. 
 
    .. versionadded:: 1.0 
    &quot;&quot;&quot;</span>

    <span class="s1">name = </span><span class="s4">'img_bmp'</span>
    <span class="s1">aliases = [</span><span class="s4">'bmp'</span><span class="s2">, </span><span class="s4">'bitmap'</span><span class="s1">]</span>
    <span class="s1">filenames = [</span><span class="s4">'*.bmp'</span><span class="s1">]</span>
    <span class="s1">default_image_format = </span><span class="s4">'bmp'</span>
</pre>
</body>
</html>